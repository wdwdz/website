---
title: "Survey data visulization"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Workflow

This is a workflow of analyzing survey data from Qualtrics. When exporting data from Qualtrics, make sure to select "Use choice text" and "Split multi-value fields into columns" and export the data as csv file. 

After downloading the file, open it and delete the first **two rows** of the raw data. Now you should have the spreadsheet with only one row as its head. This will give convenience to further data wrangling in R. 

## Import useful libraries and read the raw data to R

```{r}
library(tidyverse)

raw<-read_csv("rawdata2.csv")
names(raw)<-str_replace_all(names(raw), c("#" = "."))
colnames(raw)[5]<-"Duration"
colnames(raw)[9]<-"Distribution"
raw$StartDate<-as.Date(raw$StartDate,format='%m/%d/%y')
```

## Filter the valid sample by progress, distribution, duration and startdate
```{r}
raw<-raw[raw$StartDate>"2020-11-23",]
raw<-raw[raw$Progress>70 & raw$Duration>180 & raw$Distribution != "preview",]

```

## 1 we create new dataframes for each multichoice questions and count the number of checked boxes
```{r}
#Q2.3 nature access
Q2.3<- raw %>% 
  select(contains( "Q2.3")) %>% 
  mutate(private=ifelse(is.na(Q2.3_1),0,1)) %>% 
  mutate(deck=ifelse(is.na(Q2.3_2),0,1)) %>% 
  mutate(public=ifelse(is.na(Q2.3_5),0,1)) %>% 
  mutate(botanical=ifelse(is.na(Q2.3_7),0,1)) %>% 
  mutate(nature=ifelse(is.na(Q2.3_8),0,1)) %>% 
  mutate(woodland=ifelse(is.na(Q2.3_9),0,1)) %>% 
  mutate(river=ifelse(is.na(Q2.3_10),0,1)) %>% 
  mutate(lake=ifelse(is.na(Q2.3_11),0,1)) %>% 
  mutate(none=ifelse(is.na(Q2.3_14),0,1)) %>% 
  select(-contains("Q2.3")) %>% 
  mutate(access.score=private+deck+public+botanical+nature+woodland+river+lake)

#Q2.4 nature use type before and after
Q2.4.before<- raw %>% 
  select(contains( "Q2.4")) %>% 
  mutate(private=ifelse(is.na(Q2.4.1_1_1),0,1)) %>% 
  mutate(deck=ifelse(is.na(Q2.4.1_2_1),0,1)) %>% 
  mutate(public=ifelse(is.na(Q2.4.1_3_1),0,1)) %>% 
  mutate(botanical=ifelse(is.na(Q2.4.1_4_1),0,1)) %>% 
  mutate(nature=ifelse(is.na(Q2.4.1_5_1),0,1)) %>% 
  mutate(woodland=ifelse(is.na(Q2.4.1_6_1),0,1)) %>% 
  mutate(river=ifelse(is.na(Q2.4.1_7_1),0,1)) %>% 
  mutate(lake=ifelse(is.na(Q2.4.1_8_1),0,1)) %>% 
  mutate(none=ifelse(is.na(Q2.4.1_10_1),0,1)) %>% 
  select(-contains("Q2.4")) %>% 
  mutate(use.score.before=private+deck+public+botanical+nature+woodland+river+lake)

Q2.4.after<- raw %>% 
  select(contains( "Q2.4")) %>% 
  mutate(private=ifelse(is.na(Q2.4.1_1_2),0,1)) %>% 
  mutate(deck=ifelse(is.na(Q2.4.1_2_2),0,1)) %>% 
  mutate(public=ifelse(is.na(Q2.4.1_3_2),0,1)) %>% 
  mutate(botanical=ifelse(is.na(Q2.4.1_4_2),0,1)) %>% 
  mutate(nature=ifelse(is.na(Q2.4.1_5_2),0,1)) %>% 
  mutate(woodland=ifelse(is.na(Q2.4.1_6_2),0,1)) %>% 
  mutate(river=ifelse(is.na(Q2.4.1_7_2),0,1)) %>% 
  mutate(lake=ifelse(is.na(Q2.4.1_8_2),0,1)) %>% 
  mutate(none=ifelse(is.na(Q2.4.1_10_2),0,1)) %>% 
  select(-contains("Q2.4")) %>% 
  mutate(use.score.after=private+deck+public+botanical+nature+woodland+river+lake)

#Q3.2 nature use activity before and after
Q3.2<- raw %>% 
  select(contains( "Q3.2")) %>% 
  mutate(social_before=ifelse(is.na(Q3.2_1_1),0,1)) %>% 
  mutate(social_during=ifelse(is.na(Q3.2_1_2),0,1)) %>% 
  mutate(lowintensity_before=ifelse(is.na(Q3.2_2_1),0,1)) %>% 
  mutate(lowintensity_during=ifelse(is.na(Q3.2_2_2),0,1)) %>% 
  mutate(highintensity_before=ifelse(is.na(Q3.2_3_1),0,1)) %>% 
  mutate(highintensity_during=ifelse(is.na(Q3.2_3_2),0,1)) %>% 
  mutate(restorative_before=ifelse(is.na(Q3.2_4_1),0,1)) %>% 
  mutate(restorative_during=ifelse(is.na(Q3.2_4_2),0,1)) %>% 
  mutate(others_before=ifelse(is.na(Q3.2_5_1),0,1)) %>% 
  mutate(others_during=ifelse(is.na(Q3.2_5_2),0,1)) %>% 
  select(-contains("Q3.2")) %>% 
  mutate(total_before=social_before + lowintensity_before + highintensity_before + restorative_before + others_before) %>% 
  mutate(total_during=social_during + lowintensity_during + highintensity_during + restorative_during + others_during) 

#Q3.3 nature use companion before and after
Q3.3<- raw %>% 
  select(contains( "Q3.3")) %>% 
  mutate(myself_before=ifelse(is.na(Q3.3_1_1),0,1)) %>% 
  mutate(myself_during=ifelse(is.na(Q3.3_1_2),0,1)) %>% 
  mutate(family_before=ifelse(is.na(Q3.3_2_1),0,1)) %>% 
  mutate(family_during=ifelse(is.na(Q3.3_2_2),0,1)) %>% 
  mutate(friends_before=ifelse(is.na(Q3.3_3_1),0,1)) %>% 
  mutate(friends_during=ifelse(is.na(Q3.3_3_2),0,1)) %>% 
  mutate(workmates_before=ifelse(is.na(Q3.3_4_1),0,1)) %>% 
  mutate(workmates_during=ifelse(is.na(Q3.3_4_2),0,1)) %>% 
  mutate(others_before=ifelse(is.na(Q3.3_5_1),0,1)) %>% 
  mutate(others_during=ifelse(is.na(Q3.3_5_2),0,1)) %>% 
  select(-contains("Q3.3")) %>% 
  mutate(total_before=myself_before + family_before + friends_before + workmates_before + others_before) %>% 
  mutate(total_during=myself_during + family_during + friends_during + workmates_during + others_during)

#Q4.2 nature use reason before and after
Q4.2<- raw %>% 
  select(contains( "Q4.2")) %>% 
  mutate(exercise_before=ifelse(is.na(Q4.2_1_1),0,1)) %>% 
  mutate(exercise_during=ifelse(is.na(Q4.2_1_2),0,1)) %>% 
  mutate(stressrelief_before=ifelse(is.na(Q4.2_2_1),0,1)) %>% 
  mutate(stressrelief_during=ifelse(is.na(Q4.2_2_2),0,1)) %>% 
  mutate(fun_before=ifelse(is.na(Q4.2_3_1),0,1)) %>% 
  mutate(fun_during=ifelse(is.na(Q4.2_3_2),0,1)) %>% 
  mutate(nature_before=ifelse(is.na(Q4.2_4_1),0,1)) %>% 
  mutate(nature_during=ifelse(is.na(Q4.2_4_2),0,1)) %>% 
  mutate(family_before=ifelse(is.na(Q4.2_5_1),0,1)) %>% 
  mutate(family_during=ifelse(is.na(Q4.2_5_2),0,1)) %>% 
  mutate(friends_before=ifelse(is.na(Q4.2_6_1),0,1)) %>%
  mutate(friends_during=ifelse(is.na(Q4.2_6_2),0,1)) %>%
  mutate(others_before=ifelse(is.na(Q4.2_7_1),0,1)) %>% 
  mutate(others_during=ifelse(is.na(Q4.2_7_2),0,1)) %>% 
  select(-contains("Q4.2")) %>% 
  mutate(total_before=exercise_before + stressrelief_before + fun_before + nature_before +friends_before + family_before+ others_before) %>% 
  mutate(total_during=exercise_during + stressrelief_during + fun_during + nature_during +friends_during + family_during+ others_during)

#Q4.5 nature access barriers
Q4.5<- raw %>% 
  select(contains( "Q4.5")) %>% 
  mutate(notime=ifelse(is.na(Q4.5_3),0,1)) %>% 
  mutate(noaccess=ifelse(is.na(Q4.5_4),0,1)) %>% 
  mutate(unsafe=ifelse(is.na(Q4.5_7),0,1)) %>% 
  mutate(noones=ifelse(is.na(Q4.5_8),0,1)) %>% 
  mutate(others=ifelse(is.na(Q4.5_9),0,1)) %>% 
  select(-contains("Q4.5")) %>% 
  mutate(total_barries=notime + noaccess + unsafe + noones + others) 

#Q5.6 nature work use activity
Q5.6<- raw %>% 
  select(contains( "Q5.6")) %>% 
  mutate(eat=ifelse(is.na(Q5.6_1),0,1)) %>% 
  mutate(walk=ifelse(is.na(Q5.6_2),0,1)) %>% 
  mutate(meet=ifelse(is.na(Q5.6_3),0,1)) %>% 
  mutate(rest=ifelse(is.na(Q5.6_4),0,1)) %>% 
  mutate(others=ifelse(is.na(Q5.6_5),0,1)) %>% 
  select(-contains("Q5.6")) %>% 
  mutate(total_campusoutdoors=eat + walk + meet + rest + others) 

#Q5.7 nature work access barrier
Q5.7<- raw %>% 
  select(contains( "Q5.7")) %>% 
  mutate(nointerest=ifelse(is.na(Q5.7_1),0,1)) %>% 
  mutate(notime=ifelse(is.na(Q5.7_2),0,1)) %>% 
  mutate(discouraged=ifelse(is.na(Q5.7_3),0,1)) %>% 
  mutate(noaccess=ifelse(is.na(Q5.7_4),0,1)) %>% 
  mutate(unappealing=ifelse(is.na(Q5.7_9),0,1)) %>% 
  mutate(noprotect=ifelse(is.na(Q5.7_10),0,1)) %>% 
  mutate(others=ifelse(is.na(Q5.7_11),0,1)) %>% 
  select(-contains("Q5.7")) %>% 
  mutate(total_barriers=nointerest+notime+discouraged+noaccess+unappealing+noprotect + others) 

#Q6.2 household
Q6.2<- raw %>% 
  select(contains( "Q6.2")) %>% 
  mutate(self=ifelse(is.na(Q6.2_10),0,1)) %>% 
  mutate(childpre=ifelse(is.na(Q6.2_1),0,1)) %>% 
  mutate(childele=ifelse(is.na(Q6.2_2),0,1)) %>% 
  mutate(youthmiddle=ifelse(is.na(Q6.2_3),0,1)) %>% 
  mutate(youthhigh=ifelse(is.na(Q6.2_4),0,1)) %>% 
  mutate(partner=ifelse(is.na(Q6.2_5),0,1)) %>% 
  mutate(parents=ifelse(is.na(Q6.2_6),0,1)) %>% 
  mutate(otherfamily=ifelse(is.na(Q6.2_7),0,1)) %>% 
  mutate(friend=ifelse(is.na(Q6.2_8),0,1)) %>% 
  mutate(others=ifelse(is.na(Q6.2_9),0,1)) %>% 
  select(-contains("Q6.2")) %>% 
  mutate(total_household=childpre+childele+youthhigh+youthmiddle+partner+parents+otherfamily+friend + others) %>% 
  mutate(children=(childpre==1|childele==1|youthmiddle==1|youthhigh==1)) 

# Q6.4 family outdoor activities
Q6.4<- raw %>% 
  select(contains( "Q6.4")) %>% 
  mutate(walking=ifelse(is.na(Q6.4_2),0,1)) %>% 
  mutate(running=ifelse(is.na(Q6.4_3),0,1)) %>% 
  mutate(kayaking=ifelse(is.na(Q6.4_5),0,1)) %>% 
  mutate(gardening=ifelse(is.na(Q6.4_6),0,1)) %>% 
  mutate(relaxing=ifelse(is.na(Q6.4_7),0,1)) %>% 
  mutate(camping=ifelse(is.na(Q6.4_9),0,1)) %>% 
  mutate(fishing=ifelse(is.na(Q6.4_10),0,1)) %>% 
  mutate(others=ifelse(is.na(Q6.4_11),0,1)) %>% 
  select(-contains("Q6.4")) %>% 
  mutate(total_familyoutdoors=walking+running+kayaking+gardening+relaxing+camping+fishing + others) 

```
## 2 we recode some variables and group them with the same measurement
```{r warning=FALSE}
#time natureQ2.4, Q2.6, Q2.7, Q2.8, Q2.10
timeoutdoors<- raw %>% 
  dplyr:: select(contains(c("2.5", "2.6", "2.7","2.8", "2.10"))) %>% 
  mutate_at(vars(1),function(x)(dplyr::recode(x,"7 days"=7, "4-6 days" = 5,
                                                "2-3 days" = 2.5,"1 day" = 1,
                                                "No days" = 0))) %>% 
  mutate_at(vars(2),function(x)(dplyr::recode(x,"More than 1 hr"=60, "31min - 1hr" = 45,
                                              "15-30 min" = 22.5,"Less than 15 min" = 7.5)))

#Q4.3 How you feel after time in nature
Q4.3<- raw %>% 
  select(contains("4.3")) %>% 
  mutate_at(vars(1:5),function(x)(dplyr::recode(x,"Strongly agree"=5, "Somewhat agree" = 4,
                                                "Neither agree nor disagree" = 3,"Somewhat disagree" = 2,
                                                "Strongly disagree" = 1))) 
Q4.3$score=rowMeans(cbind(Q4.3$Q4.3_1,Q4.3$Q4.3_2,Q4.3$Q4.3_3,Q4.3$Q4.3_4,Q4.3$Q4.3_5),na.rm = TRUE)

#Q4.4 – How do you generally feel about nature
Q4.4<- raw %>% 
  select(contains("4.4")) %>% 
  mutate_at(vars(1:3),function(x)(dplyr::recode(x,"Not at all"=0, "Somewhat" = 1,
                                                "Definitely" = 3))) 
Q4.4$score=rowMeans(cbind(Q4.4$Q4.4_1,Q4.4$Q4.4_2,Q4.4$Q4.4_3),na.rm = TRUE)

#Q6.5 Spending time with family in nature
Q6.5<- raw %>% 
  select(contains("6.5")) %>% 
  mutate_at(vars(1:5),function(x)(dplyr::recode(x,"Strongly agree"=5, "Somewhat agree" = 4,
                                                "Neither agree nor disagree" = 3,"Somewhat disagree" = 2,
                                                "Strongly disagree" = 1))) 
Q6.5$score=rowMeans(cbind(Q6.5$Q6.5_1,Q6.5$Q6.5_2,Q6.5$Q6.5_3),na.rm = TRUE)

```
## 3 we visulize some basic data
```{r warning=FALSE}
Q2.3 %>% 
  ggplot(mapping = aes(x=as.factor(access.score))) +
  geom_bar(stat="count",position='dodge')

timeoutdoors %>% 
  ggplot(mapping = aes(x=as.factor(Q2.7))) +
  geom_bar(stat="count",position='dodge')+
  xlab("Weekend days – compared to weekdays ")

timeoutdoors %>% 
  ggplot(mapping = aes(x=as.factor(Q2.8))) +
  geom_bar(stat="count",position='dodge')+
  xlab("Fall 2020 Vs April-July2020")

timeoutdoors %>% 
  ggplot(mapping = aes(x=as.factor(Q2.10))) +
  geom_bar(stat="count",position='dodge')+
  xlab("Fall 2020 Vs Fall 2019")
Q3.2 %>% 
  pivot_longer(total_before:total_during,
               names_to = "time",
               values_to = "number") %>% 
  ggplot(mapping = aes(x=number,fill=time)) +
  geom_bar(stat="count",position='dodge')
Q3.2 %>% 
  pivot_longer(social_before:others_during,
               names_to = "activity",
               values_to = "number") %>% 
  group_by(activity) %>% 
  summarise_all(sum) %>% 
  ggplot(mapping = aes(x=activity,y=number)) +
  geom_bar(stat="identity")+
  theme(axis.text.x = element_text(size=10,angle = 90,hjust=.5,vjust=.5,face="plain"))

Q3.3 %>% 
  pivot_longer(total_before:total_during,
               names_to = "time",
               values_to = "number") %>% 
  ggplot(mapping = aes(x=number,fill=time)) +
  geom_bar(stat="count",position='dodge')

Q3.3 %>% 
  pivot_longer(myself_before:others_during,
               names_to = "people",
               values_to = "number") %>% 
  group_by(people) %>% 
  summarise_all(sum) %>% 
  ggplot(mapping = aes(x=people,y=number)) +
  geom_bar(stat="identity")+
  theme(axis.text.x = element_text(size=10,angle = 90,hjust=.5,vjust=.5,face="plain"))
Q5.6 %>% 
  pivot_longer(eat:others,
               names_to = "activities",
               values_to = "number") %>% 
  group_by(activities) %>% 
  summarise_all(sum) %>% 
  ggplot(mapping = aes(x=activities,y=number)) +
  geom_bar(stat="identity")


```

## 5 we visulize before and after multi choice questions, we take Q2.4 for example
```{r}

```

## 6 we do basic correlation calculation for continous, ordinal and binary data, there are different sorts of correlations between different types of variables
```{r}

```
## 7 we do basic statistic tests for norminal,ordinal and binary data such as chi2 test
```{r}

```
## 8 we do reliability test for likert data
```{r}

```
## 9 we do more complex data modeling like factor analysis and structural equation modeling
```{r}

```


